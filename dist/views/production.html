<!DOCTYPE html>
<html
    lang="en">
<head>
  <meta
      charset="UTF-8">
  <title>
    Title</title>
  <script src="vueloader"></script>
  <script src="vue/dist/vue.js"></script>
  <link rel="stylesheet" href="css/components.css"/>
  <link rel="stylesheet" href="css/index.css"/>
  <link rel="stylesheet" href="css/bootstrap.css"/>
  <script src="echarts/dist/echarts.js"></script>
  <script src="echarts/theme/macarons.js"></script>
  <script src="url.js"></script>
  <script src="veditor.js"></script>
  <script src="components.js"></script>
</head>
<body draggable = "false">
  <div id="app"></div>
  <script>
    var menus = ["abc1", "abc2", "abc3"], views = {};
    Veditor.use(Components);
    Veditor.use(comps);
    Vue.use(Veditor);
    Vue.prototype.getView = function(viewId, callback){
      var cur = this;
      if(views[viewId]){
        callback(views[viewId]);
      } else {
        cur.postJSON("api/getlayout/" + viewId, null, function(event){
          if(event.code == 0){
            views[viewId] = event.data;
            callback(views[viewId]);
          }
        });
      }
    }
    new Vue({
      template : "<div class=\"row\">\
        <div>\
          <div class=\"topmenus\">\
            <div class=\"menus\" \
              v-on:click=\"menuclick(file)\"\
              v-for=\"file in files\">\
              {{file[1]}}\
            </div>\
          </div>\
          <free-board-prev options=\"options\"></free-board-prev>\
        </div>\
      </div>",
      methods : {
        menuclick : function(file){
          var cur = this;
          cur.getView(file[0], function(d){
            cur.options = d;
          })
        }
      },
      data : function(){
        var cur = this, url = urlparse();
        cur.postJSON("api/getfiletree", null, function(event){
          if(event.code == 0){
            var layout = event.data.children.find(function(n, i){
              return n.basename === "layout";
            })
            cur.files = layout.children.map(function(n, i){
              var match = new RegExp("^view_(.*)\\.json$", "g").exec(n.basename)
              return [match[1], menus[i]];
            });
            cur.getView(cur.files[0][0], function(d){
              cur.options = d;
            })
          }
        });
        return {
          files : [],
          options : []
        }
      }
    }).$mount("#app");
  </script>
</body>
</html>